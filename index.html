<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>T·ªïng quan C·ªù vua ‚Äì Auto Menu (GitHub Pages)</title>
<meta name="description" content="Trang t·ªïng quan C·ªù vua v·ªõi menu t·ª± sinh t·ª´ c√°c file HTML trong repo. T·ª± ƒë·ªông hi·ªÉn th·ªã trang m·ªõi khi b·∫°n th√™m file.">
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --ink:#e6eef7; --muted:#9bb0cf;
    --border:#1f2a44; --accent:#60a5fa; --accent2:#22c55e; --warn:#f59e0b;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0a1120 0,#0b1220 60%,#0a101a 100%);color:var(--ink);font:15.5px/1.5 system-ui,Inter,Segoe UI,Roboto,Arial}
  a{color:inherit}
  .app{display:grid;grid-template-rows:auto 1fr}
  header{position:sticky;top:0;z-index:10;background:rgba(10,16,32,.7);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
  .wrap{max-width:1200px;margin:auto;padding:12px 16px}
  h1{margin:0;font-size:clamp(18px,2.8vw,24px);font-weight:800;letter-spacing:.2px}
  .sub{color:var(--muted);font-weight:500}
  .top{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .pill{border:1px solid var(--border);background:#0d1830;color:var(--muted);padding:6px 10px;border-radius:999px;font-size:12px}
  .btn{border:1px solid var(--border);background:#0e162c;color:var(--ink);padding:8px 10px;border-radius:10px;cursor:pointer}
  .btn.primary{background:var(--accent);border-color:transparent;color:#031024}
  .btn.ghost{background:transparent}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .search{display:flex;align-items:center;gap:8px;border:1px solid var(--border);background:#0c1630;border-radius:10px;padding:6px 10px;min-width:240px}
  .search input{background:transparent;border:none;outline:none;color:var(--ink);width:180px}
  main{display:grid;grid-template-columns:310px 1fr;gap:14px;max-width:1200px;margin:auto;padding:14px 16px}
  @media (max-width:980px){main{grid-template-columns:1fr}}
  .side{display:grid;gap:12px;height:calc(100vh - 110px)}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px}
  .menu{padding:10px;overflow:auto}
  .menu .section{padding:10px;border-bottom:1px solid var(--border)}
  .menu h3{margin:0 0 8px;font-size:14px;color:var(--muted);text-transform:uppercase;letter-spacing:1px}
  .menu ul{list-style:none;margin:0;padding:0;display:grid;gap:4px}
  .menu a{display:flex;gap:8px;align-items:center;padding:8px 10px;border-radius:8px;text-decoration:none;border:1px solid transparent}
  .menu a.active{outline:2px solid var(--accent);border-color:transparent;background:linear-gradient(180deg,#0b1a36,#0b1730)}
  .menu .item small{color:var(--muted);font-size:11px}
  .menu .meta{margin-left:auto;color:var(--muted);font-size:11px}
  .fav{color:var(--warn)}
  .hero{padding:16px}
  .hero .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
  .tile{padding:12px;border:1px solid var(--border);border-radius:12px;background:linear-gradient(180deg,#0d1830,#0e1a35)}
  .tile b{font-size:15px}
  .tile p{margin:6px 0 0;color:var(--muted);font-size:13px}
  .viewer{min-height:60vh;display:grid;grid-template-rows:auto 1fr}
  .toolbar{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border)}
  iframe{width:100%;height:calc(100vh - 210px);border:none;border-bottom-left-radius:14px;border-bottom-right-radius:14px;background:#0a1224}
  .muted{color:var(--muted)}
  .foot{padding:12px;border-top:1px solid var(--border);text-align:center;color:var(--muted);font-size:12px}
  .hidden{display:none}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="wrap top">
      <div>
        <h1>‚ôüÔ∏è T·ªïng quan C·ªù vua <span class="sub">‚Ä¢ Auto-Menu GitHub Pages</span></h1>
      </div>
      <div class="controls">
        <div class="search">
          üîé <input id="q" placeholder="T√¨m trang (g√µ / ƒë·ªÉ t√¨m nhanh)‚Ä¶" />
          <button class="btn ghost" id="btn-clear" title="X√≥a t√¨m ki·∫øm">‚úñ</button>
        </div>
        <button class="btn" id="btn-rescan" title="Qu√©t l·∫°i repo ƒë·ªÉ c·∫≠p nh·∫≠t menu">‚ü≥ Qu√©t l·∫°i</button>
        <span class="pill" id="repo-pill">Repo: ‚Äî</span>
      </div>
    </div>
  </header>

  <main>
    <aside class="side">
      <div class="card menu">
        <div class="section">
          <h3>T·ªïng quan</h3>
          <ul id="static-links">
            <li><a class="item" href="#home" data-route="home">üè† T·ªïng quan</a></li>
            <li><a class="item" href="#guide" data-route="guide">üì¶ H∆∞·ªõng d·∫´n tri·ªÉn khai</a></li>
          </ul>
        </div>
        <div class="section">
          <h3>Trang trong repo</h3>
          <ul id="repo-links"><li class="muted">ƒêang t·∫£i‚Ä¶</li></ul>
        </div>
        <div class="section">
          <h3>ƒê√£ ghim</h3>
          <ul id="pin-links"><li class="muted">Ch∆∞a ghim trang n√†o.</li></ul>
        </div>
      </div>
      <div class="card hero">
        <div class="grid">
          <div class="tile">
            <b>Lu·∫≠t c∆° b·∫£n</b>
            <p>B√†n 8√ó8, m·ª•c ti√™u chi·∫øu h·∫øt. T·ªët ƒëi th·∫≥ng, ƒÉn ch√©o; M√£ ƒëi ch·ªØ L; T∆∞·ª£ng ch√©o; Xe th·∫≥ng; H·∫≠u m·ªçi h∆∞·ªõng; Vua 1 √¥.</p>
          </div>
          <div class="tile">
            <b>Khai cu·ªôc</b>
            <p>Ki·ªÉm so√°t trung t√¢m, ph√°t tri·ªÉn qu√¢n, nh·∫≠p th√†nh s·ªõm. V√≠ d·ª•: Ruy Lopez, Italian, Queen's Gambit, Sicilian.</p>
          </div>
          <div class="tile">
            <b>Chi·∫øn thu·∫≠t</b>
            <p>Fork (chƒ©a), Pin (ghim), Skewer (xi√™n), Discovered attack (t·∫•n c√¥ng h·ªü), Mate net (l∆∞·ªõi chi·∫øu h·∫øt).</p>
          </div>
          <div class="tile">
            <b>T√†n cu·ªôc</b>
            <p>C√°c m·∫´u KQ vs K, KR vs K, c·∫Øt vua, tam gi√°c, opposition, vu√¥ng t·ªët.</p>
          </div>
        </div>
      </div>
    </aside>

    <section class="card viewer">
      <div class="toolbar">
        <div id="crumb" class="muted">Trang: <b>home</b></div>
        <div class="controls">
          <a id="view-raw" class="btn ghost" href="#" target="_blank" rel="noopener">üìÑ M·ªü trang</a>
          <a id="view-edit" class="btn ghost" href="#" target="_blank" rel="noopener">‚úèÔ∏è M·ªü tr√™n GitHub</a>
          <button id="btn-pin" class="btn ghost" title="Ghim/B·ªè ghim trang">‚≠ê Ghim</button>
        </div>
      </div>
      <iframe id="frame" srcdoc='
        <style>body{margin:0;background:#0a1224;color:#e6eef7;font:16px system-ui;}</style>
        <div style="padding:16px">
          <h2>Ch√†o m·ª´ng ƒë·∫øn trang T·ªïng quan C·ªù vua</h2>
          <p>Ch·ªçn m·ª•c b√™n tr√°i ho·∫∑c th√™m file .html v√†o repo c·ªßa b·∫°n ƒë·ªÉ menu t·ª± hi·ªán.</p>
          <ul>
            <li>V√≠ d·ª• th√™m: <code>openings.html</code>, <code>tactics.html</code>, <code>endgame.html</code>‚Ä¶</li>
            <li>M·ªói l·∫ßn b·∫•m ‚Äú‚ü≥ Qu√©t l·∫°i‚Äù, danh s√°ch s·∫Ω c·∫≠p nh·∫≠t.</li>
          </ul>
        </div>'></iframe>
    </section>
  </main>

  <footer class="foot">¬© 2025 ‚Ä¢ Chess Overview ‚Ä¢ GitHub Pages Auto-Menu ‚Ä¢ Made with ‚ù§Ô∏è</footer>
</div>

<script>
/* ========= Config & Repo detection ========= */
const STATE = {
  OWNER: "", REPO: "", BRANCH: "main",
  PAGES_MODE: "auto", // "auto" | "user" | "project"
  BASE_PATH: "",       // computed later
};
(function detect(){
  // Attempt auto-detect for GitHub Pages
  const {host, pathname} = location;
  const isGH = /\.github\.io$/i.test(host);
  if(isGH){
    // user/org pages ‚Üí owner.github.io[/] (repo == owner.github.io)
    // project pages ‚Üí owner.github.io/repo/
    const parts = pathname.replace(/^\//,'').split('/');
    if(parts.length>=1 && parts[0]){
      if(parts[0].endsWith(".github.io")){
        // user site
        STATE.OWNER = host.split(".github.io")[0];
        STATE.REPO  = STATE.OWNER + ".github.io";
        STATE.PAGES_MODE = "user";
        STATE.BASE_PATH = pathname.replace(/index\.html$/,'').replace(/\/$/,'') + '/';
      }else{
        // project site
        STATE.OWNER = host.split(".github.io")[0];
        STATE.REPO  = parts[0];
        STATE.PAGES_MODE = "project";
        STATE.BASE_PATH = '/' + parts[0] + '/';
      }
    }
  }
  // Fallback: allow manual override via query (?owner=&repo=&branch=)
  const params = new URLSearchParams(location.search);
  STATE.OWNER = params.get("owner") || STATE.OWNER || "your-github-username";
  STATE.REPO  = params.get("repo")  || STATE.REPO  || "your-repo-name";
  STATE.BRANCH= params.get("branch")|| STATE.BRANCH;
  document.getElementById("repo-pill").textContent = `Repo: ${STATE.OWNER}/${STATE.REPO}@${STATE.BRANCH}`;
})();

/* ========= Helpers ========= */
const $ = s => document.querySelector(s);
const LS = {
  get(k, def){ try{return JSON.parse(localStorage.getItem(k)) ?? def}catch{return def} },
  set(k, v){ try{localStorage.setItem(k, JSON.stringify(v))}catch{} }
};
const API = (path) => `https://api.github.com/repos/${STATE.OWNER}/${STATE.REPO}/contents/${path?path:''}?ref=${STATE.BRANCH}`;
const GH_BLOB = (path) => `https://github.com/${STATE.OWNER}/${STATE.REPO}/blob/${STATE.BRANCH}/${path}`;
function titleCase(name){
  return name
    .replace(/\.html?$/i,'')
    .replace(/[-_]+/g,' ')
    .replace(/\b\w/g, c=>c.toUpperCase());
}
function pagesUrlFor(path){
  // Build URL that the Pages site serves
  if(STATE.PAGES_MODE==="project"){
    return `/${STATE.REPO}/${path}`;
  }else{
    // user site or unknown ‚Üí assume root
    return `/${path}`;
  }
}
async function fetchJSON(url){
  const r = await fetch(url, {headers:{"Accept":"application/vnd.github+json"}});
  if(!r.ok) throw new Error(`Fetch ${url} ‚Üí ${r.status}`);
  return r.json();
}

/* ========= Menu builder ========= */
let REPO_FILES = [];
async function listHtmlFiles(){
  // Priority: /pages directory; fallback: repo root
  let files = [];
  try {
    const pages = await fetchJSON(API('pages'));
    files = pages;
  } catch(e){
    // ignore if 404
  }
  if(!files.length){
    const root = await fetchJSON(API(''));
    files = root;
  }
  // flat filter
  const htmls = files
    .filter(x => x.type === "file" && /\.html?$/i.test(x.name) && !/^index\.html?$/i.test(x.name))
    .map(x => ({ name:x.name, path:x.path, download_url:x.download_url }));
  REPO_FILES = htmls.sort((a,b)=>a.name.localeCompare(b.name));
  return REPO_FILES;
}
async function inferTitle(item){
  // Try to fetch <title> from raw file; fallback to filename
  try{
    // Prefer raw.githubusercontent.com if provided:
    const raw = item.download_url || `https://raw.githubusercontent.com/${STATE.OWNER}/${STATE.REPO}/${STATE.BRANCH}/${item.path}`;
    const r = await fetch(raw, {cache:"no-store"});
    if(r.ok){
      const txt = await r.text();
      const m = txt.match(/<title>([^<]{1,120})<\/title>/i);
      if(m) return m[1].trim();
    }
  }catch(e){}
  return titleCase(item.name);
}

/* ========= Rendering ========= */
const repoListEl = $("#repo-links");
const pinListEl = $("#pin-links");
function renderPins(pins){
  pinListEl.innerHTML = pins.length ? "" : `<li class="muted">Ch∆∞a ghim trang n√†o.</li>`;
  for(const it of pins){
    const a = document.createElement("a");
    a.className="item";
    a.href = `#page=${encodeURIComponent(it.path)}`;
    a.innerHTML = `‚≠ê <span>${it.title}</span> <span class="meta">${it.name}</span>`;
    const li = document.createElement("li"); li.appendChild(a);
    pinListEl.appendChild(li);
  }
}
async function rebuildMenu(filter=""){
  repoListEl.innerHTML = `<li class="muted">ƒêang t·∫£i danh s√°ch‚Ä¶</li>`;
  const list = await listHtmlFiles();
  const pins = LS.get("pins",[]);
  const pinMap = new Map(pins.map(p=>[p.path,true]));
  renderPins(pins);

  // Build entries with titles (parallel but capped)
  const withTitles = await Promise.all(list.map(async f => {
    const t = await inferTitle(f);
    return {...f, title:t};
  }));

  let items = withTitles;
  if(filter){
    const k = filter.trim().toLowerCase().split(/\s+/);
    items = withTitles.filter(it => k.every(w =>
      it.title.toLowerCase().includes(w) ||
      it.name.toLowerCase().includes(w)
    ));
  }

  if(!items.length){
    repoListEl.innerHTML = `<li class="muted">Kh√¥ng c√≥ trang ph√π h·ª£p. Th√™m file .html v√†o repo r·ªìi b·∫•m ‚ÄúQu√©t l·∫°i‚Äù.</li>`;
    return;
  }

  repoListEl.innerHTML = "";
  for(const it of items){
    const li = document.createElement("li");
    const a  = document.createElement("a");
    a.className = "item";
    a.href = `#page=${encodeURIComponent(it.path)}`;
    a.innerHTML = `üóÇÔ∏è <span>${it.title}</span> <small class="meta">${it.name}</small> ${pinMap.get(it.path)?'<span class="fav">‚òÖ</span>':''}`;
    li.appendChild(a);
    repoListEl.appendChild(li);
  }
  // Highlight active
  highlightActive();
}

/* ========= Router & Viewer ========= */
const frame = $("#frame");
const crumb = $("#crumb");
const viewRaw = $("#view-raw");
const viewEdit= $("#view-edit");
const btnPin  = $("#btn-pin");

function highlightActive(){
  const active = decodeURIComponent((location.hash.match(/#page=([^&]+)/)||[])[1] || (location.hash==="#guide"?"guide":"home"));
  document.querySelectorAll(".menu a").forEach(a=> a.classList.toggle("active", (a.getAttribute("data-route")||a.getAttribute("href"))?.includes(active)));
}

function loadHome(){
  crumb.innerHTML = `Trang: <b>home</b>`;
  viewRaw.href = "#";
  viewEdit.href= "#";
  btnPin.disabled = true;
  frame.srcdoc = `
    <style>body{margin:0;background:#0a1224;color:#e6eef7;font:16px/1.55 system-ui} .wrap{max-width:820px;margin:auto;padding:20px}</style>
    <div class="wrap">
      <h2>üè† T·ªïng quan C·ªù vua</h2>
      <p>ƒê√¢y l√† trang hub: t·ª´ tr√°i b·∫°n m·ªü c√°c trang con (HTML) trong repo. H·ªá th·ªëng s·∫Ω t·ª± ph√°t hi·ªán & th√™m v√†o menu.</p>
      <h3>Ch·ªß ƒë·ªÅ nhanh</h3>
      <ul>
        <li><b>Khai cu·ªôc:</b> Ruy Lopez, Italian, Queen's Gambit, Sicilian‚Ä¶</li>
        <li><b>Chi·∫øn thu·∫≠t:</b> Fork, Pin, Skewer, Discovered attack, Mate net‚Ä¶</li>
        <li><b>T√†n cu·ªôc:</b> KQ vs K, KR vs K, √¥ vu√¥ng t·ªët, opposition‚Ä¶</li>
        <li><b>Th·ª±c h√†nh:</b> T·∫°o trang <code>tactics.html</code> ho·∫∑c <code>openings.html</code> v√† ƒë·∫©y l√™n repo.</li>
      </ul>
      <p>M·∫πo: Nh·∫•n <b>/</b> ƒë·ªÉ b·∫≠t t√¨m ki·∫øm, <b>‚ü≥ Qu√©t l·∫°i</b> sau khi push.</p>
    </div>
  `;
}

function loadGuide(){
  crumb.innerHTML = `Trang: <b>H∆∞·ªõng d·∫´n tri·ªÉn khai</b>`;
  viewRaw.href = "#";
  viewEdit.href= "#";
  btnPin.disabled = true;
  frame.srcdoc = `
    <style>body{margin:0;background:#0a1224;color:#e6eef7;font:16px/1.55 system-ui} .wrap{max-width:820px;margin:auto;padding:20px} code{background:#0e1a35;padding:2px 6px;border-radius:6px}</style>
    <div class="wrap">
      <h2>üì¶ H∆∞·ªõng d·∫´n tri·ªÉn khai tr√™n GitHub Pages</h2>
      <ol>
        <li>T·∫°o repo c√¥ng khai (public) tr√™n GitHub. V√≠ d·ª•: <code>chess-overview</code>.</li>
        <li>Th√™m file n√†y l√† <code>index.html</code> v√†o repo. Commit & push.</li>
        <li>V√†o <b>Settings ‚Üí Pages</b>, ch·ªçn Source = <b>Deploy from a branch</b>, Branch = <b>main</b> (ho·∫∑c branch c·ªßa b·∫°n), Folder = <b>/ (root)</b>. Save.</li>
        <li>Th√™m c√°c trang con: v√≠ d·ª• <code>openings.html</code>, <code>tactics.html</code>, <code>endgame.html</code>‚Ä¶ (·ªü root repo, ho·∫∑c trong th∆∞ m·ª•c <code>pages/</code>).</li>
        <li>Truy c·∫≠p URL GitHub Pages c·ªßa repo: <i>username.github.io/repo/</i>.</li>
        <li>M·ªói khi b·∫°n th√™m file .html m·ªõi ‚Üí b·∫•m n√∫t <b>‚ü≥ Qu√©t l·∫°i</b> ƒë·ªÉ c·∫≠p nh·∫≠t menu (ho·∫∑c t·∫£i l·∫°i trang).</li>
      </ol>
      <h3>G·ª£i √Ω c·∫•u tr√∫c</h3>
      <pre><code>.
‚îú‚îÄ index.html        (file n√†y)
‚îú‚îÄ openings.html     (gi·ªõi thi·ªáu khai cu·ªôc)
‚îú‚îÄ tactics.html      (b√†i t·∫≠p chi·∫øn thu·∫≠t)
‚îú‚îÄ endgame.html      (t√†n cu·ªôc)
‚îî‚îÄ pages/
   ‚îú‚îÄ rules.html     (lu·∫≠t chi ti·∫øt)
   ‚îî‚îÄ glossary.html  (thu·∫≠t ng·ªØ)</code></pre>
      <p>M·∫∑c ƒë·ªãnh trang s·∫Ω ∆∞u ti√™n qu√©t <code>pages/</code>; n·∫øu kh√¥ng c√≥ th√¨ qu√©t th∆∞ m·ª•c g·ªëc repo.</p>
    </div>
  `;
}

function loadRepoPage(path){
  const url = pagesUrlFor(path);
  crumb.innerHTML = `Trang: <b>${path}</b>`;
  viewRaw.href = url;
  viewEdit.href = GH_BLOB(path);
  btnPin.disabled = false;
  frame.src = url;
  // focus active
  highlightActive();
}

function applyRoute(){
  const hash = location.hash || "#home";
  if(hash==="#home" || hash==="#"){
    loadHome(); return;
  }
  if(hash==="#guide"){
    loadGuide(); return;
  }
  const m = hash.match(/#page=([^&]+)/);
  if(m){
    const path = decodeURIComponent(m[1]);
    loadRepoPage(path);
    return;
  }
  // fallback
  loadHome();
}

window.addEventListener("hashchange", applyRoute);

/* ========= Search / Actions ========= */
const q = $("#q");
$("#btn-clear").onclick=()=>{ q.value=""; q.focus(); rebuildMenu(""); };
$("#btn-rescan").onclick=()=>{ rebuildMenu(q.value||""); };

q.addEventListener("input", (e)=>{ rebuildMenu(q.value||""); });
window.addEventListener("keydown",(e)=>{
  if(e.key==="/"){ e.preventDefault(); q.focus(); }
});

/* ========= Pin / Unpin ========= */
function currentPath(){
  const m = location.hash.match(/#page=([^&]+)/);
  return m ? decodeURIComponent(m[1]) : null;
}
$("#btn-pin").onclick=()=>{
  const path = currentPath(); if(!path) return;
  const pins = LS.get("pins",[]);
  const idx = pins.findIndex(p=>p.path===path);
  if(idx>=0){
    pins.splice(idx,1);
  }else{
    const name = path.split("/").pop();
    const title = document.title || titleCase(name);
    pins.push({path, name, title});
  }
  LS.set("pins", pins);
  renderPins(pins);
  rebuildMenu(q.value||"");
};

/* ========= Init ========= */
(async function init(){
  await rebuildMenu("");
  applyRoute();
})();
</script>
</body>
</html>
